import { __decorate, __metadata, __param, __read, __spread } from "tslib";
import { APP_INITIALIZER, Inject, InjectionToken, NgModule, Optional } from '@angular/core';
import { LocalStorageProvider, SessionStorageProvider } from './core/nativeStorage';
import { Services } from './services/index';
import { Strategies } from './strategies/index';
import { StrategyIndex } from './services/strategyIndex';
import { StorageKeyManager } from './helpers/storageKeyManager';
import * as ɵngcc0 from '@angular/core';
export var LIB_CONFIG = new InjectionToken('ngx_webstorage_config');
export function appInit(index) {
    index.indexStrategies();
    return function () { return StrategyIndex.index; };
}
var NgxWebstorageModule = /** @class */ (function () {
    function NgxWebstorageModule(index, config) {
        if (config)
            StorageKeyManager.consumeConfiguration(config);
        else
            console.error('NgxWebstorage : Possible misconfiguration (The forRoot method usage is mandatory since the 3.0.0)');
    }
    NgxWebstorageModule_1 = NgxWebstorageModule;
    NgxWebstorageModule.forRoot = function (config) {
        if (config === void 0) { config = {}; }
        return {
            ngModule: NgxWebstorageModule_1,
            providers: __spread([
                {
                    provide: LIB_CONFIG,
                    useValue: config,
                },
                LocalStorageProvider,
                SessionStorageProvider
            ], Services, Strategies, [
                {
                    provide: APP_INITIALIZER,
                    useFactory: appInit,
                    deps: [StrategyIndex],
                    multi: true
                }
            ])
        };
    };
    var NgxWebstorageModule_1;
    NgxWebstorageModule.ctorParameters = function () { return [
        { type: StrategyIndex },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [LIB_CONFIG,] }] }
    ]; };
    NgxWebstorageModule = NgxWebstorageModule_1 = __decorate([ __param(1, Optional()), __param(1, Inject(LIB_CONFIG)),
        __metadata("design:paramtypes", [StrategyIndex, Object])
    ], NgxWebstorageModule);
NgxWebstorageModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: NgxWebstorageModule });
NgxWebstorageModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function NgxWebstorageModule_Factory(t) { return new (t || NgxWebstorageModule)(ɵngcc0.ɵɵinject(StrategyIndex), ɵngcc0.ɵɵinject(LIB_CONFIG, 8)); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NgxWebstorageModule, [{
        type: NgModule,
        args: [{}]
    }], function () { return [{ type: StrategyIndex }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [LIB_CONFIG]
            }] }]; }, null); })();
    return NgxWebstorageModule;
}());
export { NgxWebstorageModule };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlLmpzIiwic291cmNlcyI6WyJuZzovbmd4LXdlYnN0b3JhZ2UvbGliL21vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLGVBQWUsRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUF1QixRQUFRLEVBQUUsUUFBUSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQy9HLE9BQU8sRUFBQyxvQkFBb0IsRUFBRSxzQkFBc0IsRUFBQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2xGLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQyxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFDOUMsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRXZELE9BQU8sRUFBQyxpQkFBaUIsRUFBQyxNQUFNLDZCQUE2QixDQUFDOztBQUU5RCxNQUFNLENBQUMsSUFBTSxVQUFVLEdBQStDLElBQUksY0FBYyxDQUE2Qix1QkFBdUIsQ0FBQyxDQUFDO0FBRTlJLE1BQU0sVUFBVSxPQUFPLENBQUMsS0FBb0I7QUFDNUMsSUFBQyxLQUFLLENBQUMsZUFBZSxFQUFFLENBQUM7QUFDekIsSUFBQyxPQUFPLGNBQU0sT0FBQSxhQUFhLENBQUMsS0FBSyxFQUFuQixDQUFtQixDQUFDO0FBQ2xDLENBQUM7QUFHRDtBQUVtQixJQUFsQiw2QkFBWSxLQUFvQixFQUFrQyxNQUFrQztBQUNyRyxRQUFFLElBQUksTUFBTTtBQUFFLFlBQUEsaUJBQWlCLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0Q7QUFBYSxZQUFOLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUdBQW1HLENBQUMsQ0FBQztBQUMxSCxJQUFDLENBQUM7QUFDRiw0QkFOYSxtQkFBbUI7QUFBRSxJQU8xQiwyQkFBTyxHQUFkLFVBQWUsTUFBdUM7QUFBSSxRQUEzQyx1QkFBQSxFQUFBLFdBQXVDO0FBQUksUUFDekQsT0FBTztBQUNULFlBQUcsUUFBUSxFQUFFLHFCQUFtQjtBQUNoQyxZQUFHLFNBQVM7QUFFVCxnQkFEQztBQUNKLG9CQUFLLE9BQU8sRUFBRSxVQUFVO0FBQ3hCLG9CQUFLLFFBQVEsRUFBRSxNQUFNO0FBQ3JCLGlCQUFLO0FBQ0wsZ0JBQUksb0JBQW9CO0FBQ3hCLGdCQUFJLHNCQUFzQjtBQUFDLGVBQ3BCLFFBQVEsRUFDUixVQUFVO0FBQ2YsZ0JBQUU7QUFDSixvQkFBSyxPQUFPLEVBQUUsZUFBZTtBQUM3QixvQkFBSyxVQUFVLEVBQUUsT0FBTztBQUN4QixvQkFBSyxJQUFJLEVBQUUsQ0FBQyxhQUFhLENBQUM7QUFDMUIsb0JBQUssS0FBSyxFQUFFLElBQUk7QUFDaEIsaUJBQUs7QUFDTCxjQUFJO0FBQ0osU0FBRyxDQUFDO0FBQ0osSUFBQyxDQUFDO0FBRUY7QUFDNkI7QUFBZ0UsZ0JBNUJ6RSxhQUFhO0FBQUksZ0RBQUQsUUFBUSxZQUFJLE1BQU0sU0FBQyxVQUFVO0FBQVE7QUFBVSxJQUZ0RSxtQkFBbUIsZ0RBRC9CLFFBQVEsQ0FBQyxFQUFFLENBQUMsckJBQ0wsQ0FFNEIsV0FBQSxRQUFRLEVBQUUsQ0FBQSxFQUFFLFdBQUEsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0FBQUUseUNBQWhELGFBQWE7QUFBVyxPQUYvQixtQkFBbUIsQ0E2Qi9COzs7Ozs7Ozs7OztrQ0FDRDtBQUFDLElBREQsMEJBQUM7QUFDQSxDQURBLEFBN0JELElBNkJDO0FBQ0QsU0E5QmEsbUJBQW1CO0FBRWhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBUFBfSU5JVElBTElaRVIsIEluamVjdCwgSW5qZWN0aW9uVG9rZW4sIE1vZHVsZVdpdGhQcm92aWRlcnMsIE5nTW9kdWxlLCBPcHRpb25hbH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0xvY2FsU3RvcmFnZVByb3ZpZGVyLCBTZXNzaW9uU3RvcmFnZVByb3ZpZGVyfSBmcm9tICcuL2NvcmUvbmF0aXZlU3RvcmFnZSc7XG5pbXBvcnQge1NlcnZpY2VzfSBmcm9tICcuL3NlcnZpY2VzL2luZGV4JztcbmltcG9ydCB7U3RyYXRlZ2llc30gZnJvbSAnLi9zdHJhdGVnaWVzL2luZGV4JztcbmltcG9ydCB7U3RyYXRlZ3lJbmRleH0gZnJvbSAnLi9zZXJ2aWNlcy9zdHJhdGVneUluZGV4JztcbmltcG9ydCB7Tmd4V2Vic3RvcmFnZUNvbmZpZ3VyYXRpb259IGZyb20gJy4vY29uZmlnJztcbmltcG9ydCB7U3RvcmFnZUtleU1hbmFnZXJ9IGZyb20gJy4vaGVscGVycy9zdG9yYWdlS2V5TWFuYWdlcic7XG5cbmV4cG9ydCBjb25zdCBMSUJfQ09ORklHOiBJbmplY3Rpb25Ub2tlbjxOZ3hXZWJzdG9yYWdlQ29uZmlndXJhdGlvbj4gPSBuZXcgSW5qZWN0aW9uVG9rZW48Tmd4V2Vic3RvcmFnZUNvbmZpZ3VyYXRpb24+KCduZ3hfd2Vic3RvcmFnZV9jb25maWcnKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGFwcEluaXQoaW5kZXg6IFN0cmF0ZWd5SW5kZXgpIHtcblx0aW5kZXguaW5kZXhTdHJhdGVnaWVzKCk7XG5cdHJldHVybiAoKSA9PiBTdHJhdGVneUluZGV4LmluZGV4O1xufVxuXG5ATmdNb2R1bGUoe30pXG5leHBvcnQgY2xhc3MgTmd4V2Vic3RvcmFnZU1vZHVsZSB7XG5cblx0Y29uc3RydWN0b3IoaW5kZXg6IFN0cmF0ZWd5SW5kZXgsIEBPcHRpb25hbCgpIEBJbmplY3QoTElCX0NPTkZJRykgY29uZmlnOiBOZ3hXZWJzdG9yYWdlQ29uZmlndXJhdGlvbikge1xuXHRcdGlmIChjb25maWcpIFN0b3JhZ2VLZXlNYW5hZ2VyLmNvbnN1bWVDb25maWd1cmF0aW9uKGNvbmZpZyk7XG5cdFx0ZWxzZSBjb25zb2xlLmVycm9yKCdOZ3hXZWJzdG9yYWdlIDogUG9zc2libGUgbWlzY29uZmlndXJhdGlvbiAoVGhlIGZvclJvb3QgbWV0aG9kIHVzYWdlIGlzIG1hbmRhdG9yeSBzaW5jZSB0aGUgMy4wLjApJyk7XG5cdH1cblxuXHRzdGF0aWMgZm9yUm9vdChjb25maWc6IE5neFdlYnN0b3JhZ2VDb25maWd1cmF0aW9uID0ge30pOiBNb2R1bGVXaXRoUHJvdmlkZXJzPE5neFdlYnN0b3JhZ2VNb2R1bGU+IHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0bmdNb2R1bGU6IE5neFdlYnN0b3JhZ2VNb2R1bGUsXG5cdFx0XHRwcm92aWRlcnM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHByb3ZpZGU6IExJQl9DT05GSUcsXG5cdFx0XHRcdFx0dXNlVmFsdWU6IGNvbmZpZyxcblx0XHRcdFx0fSxcblx0XHRcdFx0TG9jYWxTdG9yYWdlUHJvdmlkZXIsXG5cdFx0XHRcdFNlc3Npb25TdG9yYWdlUHJvdmlkZXIsXG5cdFx0XHRcdC4uLlNlcnZpY2VzLFxuXHRcdFx0XHQuLi5TdHJhdGVnaWVzLFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cHJvdmlkZTogQVBQX0lOSVRJQUxJWkVSLFxuXHRcdFx0XHRcdHVzZUZhY3Rvcnk6IGFwcEluaXQsXG5cdFx0XHRcdFx0ZGVwczogW1N0cmF0ZWd5SW5kZXhdLFxuXHRcdFx0XHRcdG11bHRpOiB0cnVlXG5cdFx0XHRcdH1cblx0XHRcdF1cblx0XHR9O1xuXHR9XG5cbn1cbiJdfQ==